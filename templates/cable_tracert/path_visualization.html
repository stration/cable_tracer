<!-- templates/cable_tracert/path_visualization.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Кабельная трассировка: {{ object }}</h5>
            </div>
            <div class="card-body">
                <div id="path-visualization"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script src="{% static 'cable_tracert/js/vis-network.min.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('path-visualization');
    const nodes = new vis.DataSet([
        {% for segment in object.segments.all %}
        {id: {{ segment.device_a.id }}, label: '{{ segment.device_a.name }}'},
        {id: {{ segment.device_b.id }}, label: '{{ segment.device_b.name }}'},
        {% endfor %}
    ]);
    
    const edges = new vis.DataSet([
        {% for segment in object.segments.all %}
        {from: {{ segment.device_a.id }}, to: {{ segment.device_b.id }}, label: 'Кабель #{{ segment.cable.pk }}'},
        {% endfor %}
    ]);
    
    const data = {
        nodes: nodes,
        edges: edges
    };
    
    const options = {
        layout: {
            hierarchical: {
                direction: 'LR',
                sortMethod: 'directed'
            }
        },
        edges: {
            arrows: 'to',
            smooth: {
                type: 'cubicBezier'
            }
        },
        physics: {
            hierarchicalRepulsion: {
                nodeDistance: 200
            }
        }
    };
    
    new vis.Network(container, data, options);
});
</script>
{% endblock %}